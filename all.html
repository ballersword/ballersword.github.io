<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>å…¨éƒ¨ç…§ç‰‡ Â· é»‘ç™½å½±è°ƒ</title>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="img/0.jpg" crossorigin />
    <link rel="stylesheet" href="base/base.css" />
    <style>
      /* ===== ç€‘å¸ƒæµï¼ˆCSS columns æ–¹æ¡ˆï¼Œå…¼å®¹æ€§å¥½ï¼‰ ===== */
      .masonry {
        --col-width: 320px;         /* æœŸæœ›åˆ—å®½ */
        --gap: 16px;
        column-width: var(--col-width);
        column-gap: var(--gap);
        max-width: min(1400px, 94vw);
        margin: 40px auto;
        padding: 0;
      }
      .masonry-item {
        break-inside: avoid;
        margin: 0 0 var(--gap) 0;
        display: inline-block;
        width: 100%;
      }

      /* å¡ç‰‡ä¸å›¾åƒ */
      .photo-card {
        position: relative;
        overflow: hidden;
        border-radius: 2px;
        box-shadow: 0 0 20px #0000006c;
        background: #111;
      }
      .photo-card img {
        width: 100%;
        height: auto;
        display: block;
        transform: translateZ(0);
        transition: transform .6s ease;
      }
      .photo-card:hover img {
        transform: scale(1.03);
      }
      .photo-card figcaption {
        font-size: 12px;
        line-height: 1.4;
        color: #d0d0d0;
        padding: 8px 10px 10px;
        border-top: 1px solid #ffffff20;
      }

      /* é¡¶éƒ¨æ¨ªå¹…ï¼ˆé™æ€èƒŒæ™¯ï¼‰ */
      header {
        position: relative;
        min-height: 36vh;
        display: grid;
        place-content: center;
        text-align: center;
        color: #fff;
      }
      header .bg {
        position: absolute; inset: 0;
        background-size: cover;
        background-position: center;
        filter: brightness(.7);
        z-index: -2;
      }
      header .scrim {
        position: absolute; inset: 0;
        background: linear-gradient(#00000060, #000000c0);
        z-index: -1;
      }
      header h1 { font-size: clamp(28px, 4.8vw, 56px); margin: 0 0 .4em; }
      header p  { opacity: .9; margin: 0 0 1.2em; }

      .top-links {
        margin-top: .5rem;
      }
      .top-links a {
        color: #fff; text-decoration: none; border-bottom: 1px solid #ffffff66;
        padding-bottom: 2px;
        transition: .25s;
      }
      .top-links a:hover { color: #ffd; border-color: #ffd; }

      /* è½»é‡ Lightbox åŸºç¡€ï¼ˆå¤ç”¨ä½ çš„ç±»åï¼‰ */
      .lb[aria-hidden="true"] { display: none; }
      .lb[aria-hidden="false"] { display: grid; }
      .lb {
        position: fixed; inset: 0; z-index: 9999;
        place-items: center;
      }
      .lb-backdrop {
        position: absolute; inset: 0; background: #000000e6;
      }
      .lb-figure {
        position: relative; max-width: min(92vw, 1400px); max-height: 92vh;
        display: grid; grid-template-rows: 1fr auto; gap: 8px;
        padding: 8px;
      }
      .lb-figure img {
        max-width: 100%; max-height: 82vh; object-fit: contain; display: block;
      }
      .lb-figure figcaption {
        color: #ddd; font-size: 14px; text-align: center;
      }
      .lb-close {
        position: absolute; top: -8px; right: -8px;
        width: 36px; height: 36px; border: none; border-radius: 50%;
        background: #000000aa; color: #fff; font-size: 20px; cursor: pointer;
      }

      footer {
        margin-top: 32px;
        text-align: center;
        color: #cfcfcf;
        padding: 24px 12px 40px;
        border-top: 1px solid #ffffff1f;
      }

      /* å°å±ä¼˜åŒ– */
      @media (max-width: 520px) {
        .masonry { --col-width: 220px; --gap: 12px; margin: 24px auto; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="bg" style="background-image:url('img/0.jpg')"></div>
      <div class="scrim"></div>
      <h1>å…¨éƒ¨ç…§ç‰‡</h1>
      <p class="reveal delay-1 in-view">æˆ‘ä»¬æ— æ³•åˆ¤æ–­ä¸€ä¸ªç¬é—´çš„ä»·å€¼ï¼Œç›´åˆ°å®ƒå˜æˆå›å¿†</p>
      <div class="top-links">
        <a href="./">â† è¿”å›é¦–é¡µ</a>
      </div>
    </header>

    <!-- ç€‘å¸ƒæµå®¹å™¨ -->
    <main id="masonry" class="masonry" aria-live="polite"></main>

    <footer>
       <div id="music-player" style="text-align: center; margin-top: 2em">
        <audio id="bgm" autoplay loop muted>
          <source src="base/HappyWorldWithMochi - Butterfly [Contemporary Classical].mp3" type="audio/mpeg" />
        </audio>
      </div>

      <script>
        // å½“ç”¨æˆ·ç‚¹å‡»ä»»æ„å¤„æ—¶ï¼Œå–æ¶ˆé™éŸ³
        document.addEventListener(
          "click",
          () => {
            const bgm = document.getElementById("bgm");
            if (bgm.muted) {
              bgm.muted = false;
              bgm.volume = 0.4;
              bgm.play();
            }
          },
          { once: true }
        );
      </script>
      <div class="license">
        <p>ğŸµ éŸ³ä¹ç‰ˆæƒå£°æ˜ Music Credits</p>
        <p>
          â€œ<a href="https://freemusicarchive.org/music/happyworldwithmochi/symphony-20-contemporary-classical/butterfly-contemporary-classical/" target="_blank" rel="noopener noreferrer">Butterfly (Contemporary Classical)</a>â€ â€” by <strong>HappyWorldWithMochi</strong>
          â€” licensed under
          <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC BY 4.0</a>.
        </p>
        <p style="margin: 0.5em auto">
          æœ¬ç«™éŸ³ä¹ä¾æ®çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™…è®¸å¯åè®®ä½¿ç”¨ã€‚<br />
          This music is used under the Creative Commons Attribution 4.0 International License.
        </p>
      </div>
      <p>Â© 2025 Ballersword Â· ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
    </footer>

    <!-- è½»é‡ Lightbox -->
    <div id="lightbox" class="lb" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="lb-backdrop" data-close="1"></div>
      <figure class="lb-figure">
        <img id="lb-img" alt="" />
        <figcaption id="lb-caption"></figcaption>
        <button class="lb-close" type="button" aria-label="å…³é—­" data-close="1">Ã—</button>
      </figure>
    </div>

    <script>
      /**
       * è¯»å–ç…§ç‰‡æ•°æ®ï¼š
       * - æ¨èæŠŠä½ ä¸»é¡¹ç›®é‡Œä½¿ç”¨çš„ JSON æŠ½æˆç‹¬ç«‹æ–‡ä»¶ï¼š/photos.jsonï¼ˆæˆ– data/photos.jsonï¼‰
       * - ç»“æ„æ”¯æŒï¼š{ title, subtitle, desc(htmlå¯é€‰), img } æˆ– { ..., imgs: [ ... ] }
       *   å•å¼ ç”¨ imgï¼Œå¤šå¼ ç”¨ imgsï¼ŒäºŒè€…ä»»ä¸€å­˜åœ¨å³å¯
       */
      const DATA_URLS = [
        'photos.json',           // ä¼˜å…ˆï¼šä¸ all.html åŒç›®å½•
        'base/photos.json'       // å¤‡é€‰ï¼šåœ¨ data/ ç›®å½•
      ];

      async function loadPhotos() {
        for (const url of DATA_URLS) {
          try {
            const res = await fetch(url, { cache: 'no-store' });
            if (!res.ok) continue;
            const json = await res.json();
            if (Array.isArray(json)) return json;
          } catch (e) { /* ç»§ç»­è¯•ä¸‹ä¸€ä¸ªè·¯å¾„ */ }
        }
        console.error('æœªæ‰¾åˆ° photos.jsonï¼Œè¯·å°†ä½ çš„ç…§ç‰‡æ•°æ®æ”¾åˆ°åŒç›®å½•æˆ– data/ ä¸‹ã€‚');
        return [];
      }

      /** å°† {img}/{imgs} æ‘Šå¹³ä¸ºå•å¼ å›¾ç‰‡æ¡ç›® */
      function flattenToImages(PHOTOS) {
        const out = [];
        for (const item of PHOTOS) {
          const { title='', subtitle='', desc='', local='' } = item || {};
          const caption = [title, subtitle].filter(Boolean).join(' | ');
          if (Array.isArray(item.imgs)) {
            for (const src of item.imgs) out.push({ src, caption, desc, local });
          }
          if (item.img) out.push({ src: item.img, caption, desc, local });
        }
        return out;
      }

      /** ç”Ÿæˆå•ä¸ªå¡ç‰‡ DOM */
      function createMasonryCard({ src, caption }) {
        const wrap = document.createElement('div');
        wrap.className = 'masonry-item';
        const fig = document.createElement('figure');
        fig.className = 'photo-card';
        const img = document.createElement('img');
        img.loading = 'lazy';
        img.decoding = 'async';
        img.src = src;
        img.alt = caption || '';
        img.dataset.caption = caption || '';
        fig.appendChild(img);

        if (caption) {
          const fc = document.createElement('figcaption');
          fc.textContent = caption;
          fig.appendChild(fc);
        }
        wrap.appendChild(fig);
        return wrap;
      }

      /** æ¸²æŸ“å…¨éƒ¨å›¾ç‰‡åˆ°ç€‘å¸ƒæµ */
      async function renderAll() {
        const container = document.getElementById('masonry');
        const PHOTOS = await loadPhotos();
        const images = flattenToImages(PHOTOS);
        const frag = document.createDocumentFragment();
        for (const it of images) frag.appendChild(createMasonryCard(it));
        container.appendChild(frag);
      }

      /** ç®€æ˜“ Lightboxï¼ˆç‚¹å‡»å›¾ç‰‡æ”¾å¤§ï¼‰ */
      function setupLightbox() {
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lb-img');
        const lbCap = document.getElementById('lb-caption');

        document.getElementById('masonry').addEventListener('click', e => {
          const img = e.target.closest('img');
          if (!img) return;
          lbImg.src = img.currentSrc || img.src;
          lbImg.alt = img.alt || '';
          lbCap.textContent = img.dataset.caption || img.alt || '';
          lb.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        });

        lb.addEventListener('click', e => {
          if (e.target.dataset.close) {
            lb.setAttribute('aria-hidden', 'true');
            lbImg.src = '';
            document.body.style.overflow = '';
          }
        });

        window.addEventListener('keydown', e => {
          if (e.key === 'Escape' && lb.getAttribute('aria-hidden') === 'false') {
            lb.setAttribute('aria-hidden', 'true');
            lbImg.src = '';
            document.body.style.overflow = '';
          }
        });
      }

      // å¯åŠ¨
      renderAll();
      setupLightbox();
    </script>
  </body>
</html>
