
  /** ===== 1) 数据：支持多图 imgs（也兼容单图 img） ===== */
      const PHOTOS = [
        {
    title: " 牢不可破的红白蓝",
    subtitle: "Highland • 35mm • f/5.6",
    desc: "<p>多年以后，面对埃菲尔铁塔，我会想起10多年前第一次玩《红色警戒2》苏军在巴黎建起“大型磁暴线圈”的那个下午……</p><p>第一次去欧洲旅行的人们，首站大概率都会来巴黎，而到了巴黎的首站，大概率都会在这个角度观察一下古斯塔夫先生留下的杰作（去到天津也是，解放桥也是埃菲尔设计的）。</p><p>我还记得当时盯着埃菲尔铁塔过了很长时间，有某个瞬间，脑子里面竟奇怪的闪现了好多苏联式建筑。</p><p>似乎塔尖上插上一颗血红的五角星一点也不违和，甚至更添加了些许威武雄壮。然后脑子里回荡的《马赛曲》自然过渡成了《牢不可破的联盟》，红白蓝三色变成了红黄两色，“自由、平等、博爱”变成了“全世界工人阶级联合起来”，站在战神广场上，仿佛身处红场，耳畔响起了阅兵时候苏联军队震耳欲聋的“乌拉！”。</p><p>这个念头一晃而过，苏联也成为过去式，天空还是蓝色的，塔尖也没有红色五角星……</p>",
    tags: ["风光","引导线","清晨"],
    img: "img/bw/1.jpg",//多图兼容 imgs
    // exif: { focal:"35mm", aperture:"f/5.6", shutter:"1/640s", iso:"ISO 100" }
    local: "法国·巴黎"
  },
  {
    title: "斑驳的人性",
    subtitle: "Seascape • 85mm • f/4",
    desc: "<p>那是一次异常成功的避雨。</p><p>记得这时候是17年的初夏，我赶在第一滴雨落在我身上之前冲进了十字路口的一家吉野家。过了不到10秒，身后暴雨应声而落，好险！</p><p>我点了份双拼，坐在了平时最喜欢的面对窗户的位置上，盯着外面的匆匆行人，一种幸灾乐祸的“幸福感”油然而生。人可能就是这样，当你获得了庇护，你就不希望后面来的人也获得同样的庇护，甚至不会影响到你自己也不希望。</p><p>躲过了雨，于是我的兴趣点发生了转移，看到雨点咔咔的敲在玻璃上，像是掌声一样，窗子也因为下雨起了雾气，水滴洒在上面像极了iPhone早期的一个壁纸，斑斑驳驳的也很美……</p>",
    tags: ["海景","极简","留白"],
    img: "img/bw/2.jpg",
    local: "北京·西三旗"
  },
  {
    title: "存钱",
    subtitle: "City • 24mm • f/8",
    desc: "<p>那天晚上从公司出来，路上横七竖八不规则的散布着很多氛围灯。</p><p>说实话，我很不适应从脚底下窜上来的灯光，所以如果必须在公司呆到晚上，我都会避免走这条路。自下而上的光很晃眼，而且每次经过总有一种焦化厂的感觉，不知道会不会突然从脚底下窜上来个火柱、毒气什么的。</p><p>所幸的是，那天新买了一个玻璃的小猪存钱罐，我把它蹲在了其中一个灯泡上面，效果还不错……这对它来说基本算是艺术品待遇了。</p><p>新年新愿望，多存钱！！！</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/3.jpg",
    local: "北京·公司园区"
  },
   {
    title: "谣言",
    subtitle: "City • 24mm • f/8",
    desc: "<p>客观的说，这个角度拍什么都会很震撼，但是我拍下这个并不是因为景色有多壮美，是因为发现了一个谣言…</p><p>往来北京的航班航路都是走的北京东边，所以买左侧靠窗位置的机票，总能看到国贸三期中国尊。</p><p>最开始偷着拍下这张照片的时候我还犹豫了一下，远处那是国贸么……拍下来经过放大才确认，没错就是！</p><p>按距离推算我飞机下面垂直投影距离国贸最多也是20km到30km应该还是朝阳通州的交接地带，这个曾经的中国最高建筑就已经很是模糊了，那我曾经深信不疑的“宇航员在太空能看见长城”就更加滑天下之大稽了。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/4.jpg",
    local: "北京·朝阳上空某处"
  },
  {
    title: "钓鱼",
    subtitle: "City • 24mm • f/8",
    desc: "<p>这是我近几年最敬佩的大爷，没有之一。</p><p>是日，天寒地冻，河面皲裂。街上空无一人，两岸万籁俱寂。大爷单人独骑，一人一车一马扎，独坐海河中央，任凭狂风吹打，凿冰求鱼，岿然不动，颇有古风。</p><p>正是：大梦谁先觉？平生我自知。自己不尴尬，尴尬就是你。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/5.jpg",
    local: "天津·海河"
  },
  {
    title: "一汪积水",
    subtitle: "City • 24mm • f/8",
    desc: "<p>我经过公司大门的时候是想要拍下积水倒映出来的天空，一个错误的ps指令，导致画面意外的被垂直翻转了180度，不过...我不打算复原了。</p><p>不知道别人会不会时常有“我们存在的到底是真实还是虚幻”的错觉，这种感觉多数出现在ktv或者电影院刚走出来的时候。我每次从一个封闭昏暗的空间刚出来，总感觉浑身不自在，甚至步子都不是很稳(有些时候睡午觉醒了之后也有这种感觉).....那种感觉很奇妙。</p><p>记得曾经看到过一个理论，其实我们所处的世界正是一个类似《黑客帝国》的虚拟世界，而时不时爆出来的一些超自然现象，其实是我们这个世界系统的bug。。。就好比雨天的这一汪积水，如果哪一天我们走着走着天空真的突然出现了这种不自然的涟漪，我们会怀疑自己才是活在倒影里的人么？</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/6.jpg",
    local: "北京·公司门口"
  },
  {
    title: "要有光",
    subtitle: "City • 24mm • f/8",
    desc: "<p>这其实算是个Tips！</p><p>那时候我刚学摄影没多久，当时也没所谓的光笔艺术这个词，只是在教程里看的，根据一些长曝光原理可以形成这种流光，我想每一个学摄影的大多数人都会被这个吸引。</p><p>具体的方法网上有很多教程就不阐述了，只是多数都需要两个人，一个负责拍一个负责写…我这几个片子是单打独斗拍的并且没ps，所以有必要给大家做个提醒！</p><p>1:要曝光足够长的时间，真的，多长时间都不长。<br />2:自己要知道站在哪，别出镜，有条件在地上画个道。<br />3:要有空间感，知道自己的笔画。<br />4:如果相机或者手机有二次曝光功能，可以拍p2这种，既有光又有人（虽然只拍上个腿）这种片子。</p><p>对了，还有最重要的，要有光！</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/7.jpg",
    local: "北京·鸟巢"
  },
  {
    title: "赤色要塞小队城北分队",
    subtitle: "City • 24mm • f/8",
    desc: "<p>盯着这几个大爷出神了……</p><p>16年那时候因为一些原因周末频繁出没于小西天附近，总看见这些企图网上鱼来的老大爷。相信这些老街旧邻的肯定从小就一块玩，现在的风采犹不减当年。</p><p>我小的时候也一样，那时候没有现在这些电子设备，谁家有个“小霸王”能玩个《赤色要塞》那已经算是资产阶级了。大多时候都是几个孩子让大孩子领着头就在街上傻玩，弄辆三轮车、拿着竹棍幻想自己就是赤色要塞里的小分队，保护整个街区。</p><p>这几个大爷肯定当年也组成了小分队，年少时候肯定主攻鸟窝，只不过年龄不济，现如今不掏鸟窝了改成捞鱼了，那句话真没错，男儿至死是少年。</p><p>好久没去小西天了，不知道大爷们还在不在那玩，捞到鱼没……</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/8.jpg",
    local: "北京·小西天"
  },
  {
    title: "卐字不到头",
    subtitle: "City • 24mm • f/8",
    desc: "<p>以前的地图都是怎么画的呢？ 这个问题到现在让我依然很困惑。</p><p>昌平往北，换个视角就能看到不一样的风景，很难想象明朝那时候，人们没有任何飞行器，也不曾掌握经纬度，是怎么俯察大地找到京北这么一块风水宝地的。这座大山鸟瞰下去简直就是个佛家“卐字不到头”莲花生模样的神山....十三陵真是修对地方了，赞叹古人！</p><p>P.S. 再次重申，使用手机是不会影响飞行安全的，包括飞行的各个阶段都是安全的，所以如果空姐没强制要求，大可不必开飞行甚至关机。航管局那边2017年也更改要求，现行规则是不作统一要求，各航空公司自行规定是否要关机...在咱们国家，中央要是这么规定，说明就没安全问题。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/9.jpg",
    local: "北京·延庆上空"
  },
   {
    title: "首航—出港",
    subtitle: "City • 24mm • f/8",
    desc: "<p>这张照片拍摄于2015年5月8日早上7点55分，之所以印象深刻，有四个原因：</p><p>1、第一次看见停着的真飞机。<br />2、第一次坐飞机。<br />3、手机照片记录了拍摄时间....<br />4、因为闹了个笑话。</p><p>那天是本人第一次坐飞机而且是出国旅行，并且也没来过机场这边，不知道登机前要什么手续，所以生怕耽误了，以至于值机比预计出发时间稍稍微微的早了那么“一丢丢”，于是就有了我和值机柜台员工的这些对话。</p><p>地勤：先生您好<br />我：您好 <递上护照><br />地勤：<敲打键盘并查看屏幕半分钟> 先生您去哪里？<br />我：阿姆斯特丹 <狐疑><br />地勤：<又是半分钟，略微皱眉><br />我：<怎么了？><br />地勤：您是直飞，还是北京到巴黎，然后巴黎转飞阿姆？<br />我：直飞 <不会没出票吧，不老少钱呢><br />地勤：<突然放松> 哦，您是KL898，11点50起飞的，额，现在7点半，您确定现在要进去么？<br />我：嗯<br />地勤：好的</p><p>就这样4个小时后，开启了首航！</p><p>过后回想：可能以后再也不会有这种机会了，走过一遍的路，再走就很顺了。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/10.jpg",
    local: "北京·首都机场"
  },
  {
    title: "首航—在途",
    subtitle: "City • 24mm • f/8",
    desc: "<p>基本上，我是个碳酸饮料爱好者，市面上常见的碳酸饮料，基本都喝过了，转了一大圈，个人认为还是无糖可乐最好喝，还有怡泉的香草碳酸。但是，Schweppes这个词怎么读呢？</p><p>飞行途中，远远看见推车里有Schweppes，想想还没喝过，这次一定要尝尝。但是忽略了我这塑料英语的水平，于是就有了和荷兰籍空姐的这些对话。</p><p>空姐：Would you like something to drink?<br />我：shi..shi..wa<br />空姐：Sorry？<br />我：oh..coke,please<br />空姐：coke,ok..ice?<br />我：no,thanks<br />空姐：my pleasure...</p><p>就这样10分钟后，开始了巡航飞行！</p><p>过后回想：尴尬死了，哎。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/11.jpg",
    local: "北京·飞行途中"
  },
  {
    title: "首航—到达",
    subtitle: "City • 24mm • f/8",
    desc: "<p>没想到面子找回来的还是比较快的，只是换了个方式。因为老外没有训练过拼音，所以一些国人很适应的字母组合，他们看起来很怪异，比如：zh ji xi....这些组合他们是绝读不出来的。</p><p>经过了11小时的长途飞行，晕的乎的下了飞机，出了海关的第一件事就是把护照连同护照包一齐给丢了，丢了，丢了！我还没反应过来，女朋友急的不行，忙带着我找了一圈人，最后一个保安大爷说给放服务台了，于是在女朋友的翻译下有了这些对话。</p><p>服务台：Hello<br />我：您好，我护照刚刚丢了<br />服务台：where are you from？<br />我：中国<br />服务台：did you just arrive for now？<br />我：嗯坐的KL898<br />服务台：is this blue bag,the small one？<br />我：对对对就这个<br />服务台：ok,let me see,Mr. zzzi..ou...yyia...an...<br />我：zhao jian<br />服务台：(LoL)haha,sorry,I can't pronounce these sounds...<br />我：谢谢</p><p>就这样1个小时后，结束了首航！</p><p>过后回想：要是外国人坐地铁来我们公司，看见XIXIAOKOU，绝对会崩溃的。</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/12.jpg",
    local: "荷兰·史基浦机场"
  },
  {
    title: "开会",
    subtitle: "City • 24mm • f/8",
    desc: "<p>每次开会的时候，都很容易走神，估计大多数人也是吧，盯着什么东西都能胡思乱想。</p><p>纸杯子是谁发明的呢？......这个发明好啊，来个客人不用去刷茶具，人家也觉得干净，抓点茶叶什么的......手抓是不是不太卫生啊，但是家里弄个专门取茶叶的铲子挺没必要的，见过那种小茶铲子，细长的铲子头像是洛阳铲似的......好像洛阳铲是民国时候一个河南人发明的吧，但是那玩意就是半个管子状的插地里怎么能把土带出来呢，土黏性有那么大吗.....要是地太潮了肯定就没什么古墓了，早就烂完了，看过马未都的节目，盗墓的话，尽量不要选择汉朝、宋朝的，那时候薄葬，而且都是木质陪葬品，很容易烂......还挺喜欢马爷的节目的，之前在youku做语言类节目他自己还说来着，他是这种语言类节目里岁数最大的，现在也不怎么更新了......他号称还要出三本讲瓷器的书呢，我买了一本，后两本也不知道什么时候出，说了很多奇奇怪怪的故事，还挺好看的，马爷在圆桌派上讲过几个......圆桌派越来越没劲了，尺度越来越小了，还挺喜欢以前几季的嘉宾，陈丹青、马家辉、梁文道他们，还有汪海林，讲电视剧抄袭的那几集也挺好玩......对，就是那集说的，咱们有几年疯狂拍盗墓的电视剧，其实根本就不知道真实的盗墓是怎么回事......马爷还说来着呢，现在文物开掘都是抢救性的，打开一个墓穴，一看就知道这已经被盗了，山东人来过、陕西人来过、广东人来过，看一地的烟头就知道，还有遍地的方便面桶、酒瓶子、易拉罐、纸杯子......纸杯子是个好东西啊......是谁发明的呢？</p>",
    tags: ["城市","长曝光","夜景"],
    img: "img/bw/13.jpg",
    local: "北京·公司"
  },
      ];

      /** ===== 2) 参数 ===== */
      const BATCH_SIZE = 8;
      const USE_INFINITE_SCROLL = true;

      /** ===== 3) src/srcset（本地图直接用 src；如有多尺寸可扩展） ===== */
      function buildSrc(u, w = 1200) { return u; }
      function buildSrcSet(u)        { return ""; }

      /** ===== 4) 渲染逻辑（分批 + 懒加载 + 视差仅作用于可见项） ===== */
      const gallery = document.getElementById('gallery');
      const tpl = document.getElementById('work-tpl');
      let cursor = 0;

      function createPhotoCard(src, local, altText = "") {
        const card = document.createElement('div');
        card.className = 'photo-card reveal';
        card.innerHTML = `
          <div class="photo-zoom" aria-label="悬停放大查看">
            <img src="${buildSrc(src, 1200)}" srcset="${buildSrcSet(src)}" sizes="(max-width: 920px) 92vw, 600px" alt="${altText}" loading="lazy" decoding="async" />
            <div class="local" role="note">
              <span>${local}</span>
            </div>
          </div>
        `;
        return card;
      }

      function renderNextBatch() {
        const frag = document.createDocumentFragment();
        const end = Math.min(cursor + BATCH_SIZE, PHOTOS.length);

        for (let i = cursor; i < end; i++) {
          const data = PHOTOS[i];
          const node = tpl.content.cloneNode(true);
          const section = node.querySelector('section.work');
          const bgDiv   = node.querySelector('.bg');
          const title   = node.querySelector('.title');
          const sub     = node.querySelector('.sub');
          const desc    = node.querySelector('.desc');
          const tags    = node.querySelector('.tags');
          const group   = node.querySelector('.photo-group');

          // 背景（可同图）
          const bgUrl = buildSrc(data.bg || data.img || (data.imgs && data.imgs[0]) || '', 1600);
          section.dataset.bg = bgUrl;
          if (bgUrl) bgDiv.style.backgroundImage = `url("${bgUrl}")`;

          // 文字
          title.textContent = data.title || '';
          sub.textContent   = data.subtitle || '';
          desc.innerHTML    = data.desc || '';
          tags.innerHTML    = (data.tags || []).map(t => `<span class="tag">${t}</span>`).join('');

          // 照片卡：支持 imgs（多图）或 img（单图）
          const imgs = Array.isArray(data.imgs) && data.imgs.length ? data.imgs : (data.img ? [data.img] : []);
          imgs.forEach(src => group.appendChild(createPhotoCard(src, data.local, data.title || '')));

          // ✅ 奇偶行交错
          if (i % 2 === 0) section.classList.add('layout-left');
          else section.classList.add('layout-right');

          frag.appendChild(node);
        }

        gallery.appendChild(frag);
        cursor = end;

        // 新增元素参与入场动画 & 视差观察
        observeNewItems();
        if (cursor >= PHOTOS.length) {
          const btn = document.getElementById('loadMore');
          if (btn) btn.disabled = true;
          if (observerInfinite) observerInfinite.disconnect();
        }
      }

      /** ===== 5) 入场动画：一次性 reveal ===== */
      const ioReveal = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            e.target.classList.add('in-view');
            ioReveal.unobserve(e.target);
          }
        });
      }, { threshold: .15, rootMargin: '0px 0px -10% 0px' });

      /** ===== 6) 视差：只对可见区块的 .bg 计算 transform ===== */
      const activeBGs = new Set();
      const ioParallax = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          const bg = e.target.querySelector('.bg');
          if (!bg) return;
          if (e.isIntersecting) activeBGs.add(bg);
          else activeBGs.delete(bg);
        });
      }, { root: null, threshold: 0, rootMargin: '200px 0px 200px 0px' });

      function parallax() {
        const scrollY = window.scrollY || window.pageYOffset;
        activeBGs.forEach(bg => {
          const host = bg.parentElement;
          if (!host) return;
          const rect = host.getBoundingClientRect();
          const elTop = rect.top + scrollY;
          const offset = (scrollY - elTop) * 0.25;
          bg.style.transform = `translateY(${offset}px) scale(1.08)`;
        });
      }
      window.addEventListener('scroll', parallax, { passive: true });
      window.addEventListener('resize', parallax);

      /** ===== 7) 无限滚动（可选） ===== */
      let observerInfinite = null;
      function setupInfiniteScroll() {
        const sentinel = document.getElementById('loadMore');
        observerInfinite = new IntersectionObserver((entries) => {
          entries.forEach(e => {
            if (e.isIntersecting && cursor < PHOTOS.length) renderNextBatch();
          });
        }, { root: null, threshold: 0.1 });
        observerInfinite.observe(sentinel);
      }

      /** ===== 8) 交给观察器 ===== */
      function observeNewItems() {
        // 观察每个 section（视差）与其中的 .reveal（入场）
        document.querySelectorAll('section.work:not([data-obs])').forEach(sec => {
          sec.setAttribute('data-obs', '1');
          ioParallax.observe(sec);
          sec.querySelectorAll('.reveal:not(.in-view)').forEach(el => ioReveal.observe(el));
        });
        parallax();
      }

      /** ===== 9) 头尾背景也参与视差 ===== */
      document.querySelectorAll('header, footer').forEach(el => {
        const bg = el.querySelector('.bg');
        if (bg && el.dataset.bg) bg.style.backgroundImage = `url("${el.dataset.bg}")`;
        ioParallax.observe(el);
      });

      /** ===== 10) 事件：加载更多按钮 ===== */
      document.getElementById('loadMore').addEventListener('click', renderNextBatch);

      /** ===== 11) 首次渲染 & 可选无限滚动 ===== */
      renderNextBatch();
      if (USE_INFINITE_SCROLL) setupInfiniteScroll();
